{{! views/admin/users-list.hbs }}
<h1>Gestão de Utilizadores</h1>
<p>Utilizadores registados no sistema.</p>

<a href="/admin/users/add" style="background: #28a745; color: white; padding: 10px; text-decoration: none; border-radius: 5px;">
    + Adicionar Novo Utilizador
</a>

<br><br>

{{#if (lookup @root.query "error")}}
    <div style="color: red; border: 1px solid red; padding: 10px; margin-bottom: 15px;">
        <strong>Erro:</strong> 
        {{#if (eq (lookup @root.query "error") "self_delete")}}
            Não pode eliminar o seu próprio utilizador.
        {{else if (eq (lookup @root.query "error") "self_edit_forbidden")}}
            Não pode editar o seu próprio utilizador através deste painel.
        {{else if (eq (lookup @root.query "error") "not_found")}}
            Utilizador não encontrado.
        {{else}}
            {{lookup @root.query "error"}}
        {{/if}}
    </div>
{{/if}}

<table border="1" style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Cargo (Role)</th>
            <th>Ativo?</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {{#each users}}
        <tr>
            <td>{{this.id}}</td>
            <td>{{this.username}}</td>
            <td>{{this.role}}</td>
            <td>
                {{#if this.is_active}} Sim {{else}} Não {{/if}}
            </td>
            <td>
                <a href="/admin/users/edit/{{this.id}}">Editar</a>
                
                {{! Botão de eliminar - Não eliminamos o utilizador logado }}
                {{#if (neq @root.user.id this.id)}}
                    |
                    {{! Usamos um mini-formulário para o DELETE (via POST) }}
                    <form action="/admin/users/delete/{{this.id}}" method="POST" style="display: inline;" onsubmit="return confirm('Tem a certeza que quer eliminar {{this.username}}?');">
                        <button type="submit" style="color: red; background: none; border: none; cursor: pointer; padding: 0; font-size: 1em;">
                            Eliminar
                        </button>
                    </form>
                {{/if}}
            </td>
        </tr>
        {{else}}
        <tr>
            <td colspan="5">Nenhum utilizador encontrado.</td>
        </tr>
        {{/each}}
    </tbody>
</table>
<br>
<a href="/dashboard">Voltar ao Dashboard</a>